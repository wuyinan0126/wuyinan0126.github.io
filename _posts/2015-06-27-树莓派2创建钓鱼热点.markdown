---
title:  "树莓派2创建钓鱼热点"
date:   2015-06-27 15:13:23
categories: [geek]
tags: [geek]
---

*使用树莓派2和无线网卡创建钓鱼热点。包括树莓派、Raspbian系统、无线网卡和Micro SD卡的介绍，以及相关软件的安装和配置*

## 关于树莓派
---

> The Raspberry Pi is a tiny and affordable computer that you can use to learn programming through fun, practical projects.

[树莓派][respberry-pi]是一个小型的而且很便宜的（$35）电脑，在这个电脑上你可以通过有趣的实用的项目学习编程

树莓派2 Model B长这样：

![树莓派2 Model B](/assets/2015-06-27-树莓派2创建钓鱼热点-1.jpg "树莓派2 Model B")

## 关于系统
---

> Raspbian is a free operating system based on Debian optimized for the Raspberry Pi hardware. 

树莓派官方出的系统是[Raspbian][respbian]，基于Debian并根据树莓派的硬件进行了优化

当然其他的操作系统，如Ubuntu、Fedora都有针对树莓派的版本。我选的系统是Kali Linux，选它的原因请参考标题

Kali官方有针对树莓派2的版本，具体安装教程：[Kali Linux – Raspberry Pi | Kali Linux][kali-linux]

## 关于无线网卡和Micro SD卡
---

我选的无线网卡是[EDUP EP-N8508GS黄金版 迷你USB无线网卡 树莓派专用][edup]，芯片是rtl8188cus，免驱即插即用。

选择无线网卡的时候请参考官网：[RPi USB Wi-Fi Adapters][rpi-adapters]

我选的Micro SD卡是[闪迪（SanDisk）32GB UHS-I 至尊高速移动MicroSDHC-TF存储卡（读速48Mb/s）][sandisk]

选择Micro SD卡的时候请参考官网：[RPi SD cards][rpi-sd-cards]

## 安装和配置相关软件
---

假设已经按照教程安装好了系统，也插上无线网卡了，接下来就是安装必要的软件。

连接树莓派的方式有通过显示器（需要HDMI转接头）、SSH登录、VNC连接等，因为Kali开机自动启动SSH Server，所以只要知道树莓派的IP地址，用SSH连过去就行了，Kali的默认用户名是root，登录密码是toor。

代码前有#的表示在bash下以root身份运行的代码，没有的表示修改的文件内容。

1. 修改更新源，在/etc/apt/sources.list中添加：

		deb http://mirrors.ustc.edu.cn/kali kali main non-free contrib
		deb-src http://mirrors.ustc.edu.cn/kali kali main non-free contrib
		deb http://mirrors.ustc.edu.cn/kali-security kali/updates main contrib non-free
		deb http://mirrors.aliyun.com/kali kali main non-free contrib
		deb-src http://mirrors.aliyun.com/kali kali main non-free contrib
		deb http://mirrors.aliyun.com/kali-security kali/updates main contrib non-free

	然后进行更新：

		# apt-get update && apt-get upgrade

2. 根分区扩充

	下面链接中的文件可能有更新，请根据需要进入对应目录选择版本

		# wget http://archive.raspberrypi.org/debian/pool/main/r/raspi-config/raspi-config_20150131-1_all.deb
		# wget http://http.us.debian.org/debian/pool/main/t/triggerhappy/triggerhappy_0.3.4-2_armhf.deb
		# wget http://http.us.debian.org/debian/pool/main/l/lua5.1/lua5.1_5.1.5-7.1_armhf.deb
		# dpkg -i triggerhappy_0.3.4-2_armhf.deb
		# dpkg -i lua5.1_5.1.5-7.1_armhf.deb
		# dpkg -i raspi-config_20150131-1_all.deb

	然后使用raspi-config命令进入系统设置，选择第一项Expand Filesystem扩充，当然系统设置中还有其他设置，根据需要进行设置即可。用df -lh检查文件系统大小，根分区是否为SD卡大小

3. 安装和配置hostapd

	hostapd的作用是提供无线共享，即配置并成功运行hostapd后，能够搜索到热点

		# apt-get install hostapd

	由于无线网卡支持的问题，系统安装的hostapd不支持rtl8188cus芯片，需要将hostapd替换为兼容版本：

		# wget http://www.daveconroy.com/wp3/wp-content/uploads/2013/07/hostapd.zip
		# unzip hostapd.zip 
		# sudo mv /usr/sbin/hostapd /usr/sbin/hostapd.bak
		# sudo mv hostapd /usr/sbin/hostapd.cat
		# sudo ln -sf /usr/sbin/hostapd.cat /usr/sbin/hostapd  
		# sudo chmod 755 /usr/sbin/hostapd

	修改（没有的话新建）/etc/hostapd/hostapd.conf：

		interface=wlan0            
		ctrl_interface=wlan0
		ctrl_interface_group=0
		ssid=BUAA-WiFi                # 伪热点名，例如我的是校园网的WiFi热点名            
		channel=2                  
		macaddr_acl=0              
		ignore_broadcast_ssid=0    
		driver=rtl871xdrv         
		hw_mode=g                        
		wmm_enabled=1

	因为是用来钓鱼的伪热点，所以不设置热点密码

	修改/etc/default/hostapd，去掉DAEMON_CONF前的注释符号并修改为我们的配置文件路径：

		DAEMON_CONF="/etc/hostapd/hostapd.conf"

	启动hostapd：

		# service hostapd start
		
## 测试运行
---

首先连接上伪热点BUAA-WIFI，然后在浏览器输入一个网址，浏览器将自动跳转到校园网登录界面：

![测试界面](/assets/2015-06-27-树莓派2创建钓鱼热点-2.jpg "测试界面")

当用户输入登录的用户名和密码，点击登录后，将跳转到错误页面，但是用户名和密码都已经被后台服务器记录到文件中。

[respberry-pi]:	https://www.raspberrypi.org/
[respbian]:		https://www.raspbian.org/
[kali-linux]:	http://docs.kali.org/kali-on-arm/install-kali-linux-arm-raspberry-pi
[edup]: 		http://item.jd.com/509932.html
[rpi-adapters]:	http://elinux.org/RPi_USB_Wi-Fi_Adapters
[sandisk]:		http://item.jd.com/679773.html
[rpi-sd-cards]:	http://elinux.org/RPi_SD_cards
